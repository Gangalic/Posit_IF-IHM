<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Demande de consultation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="//code.jquery.com/jquery-1.12.1.min.js"></script>
    </head>
    <body>
        <div class="row">
            <div style="flex:64%" align ="left">
                <h1>POSIT'IF</h1>
            </div>
            <div style="flex:12%" align ="left">
                <br/>
                <a href="Consultation.html" class="upperButton" >Voyance</a>
            </div>
            <div style="flex:12%" align ="left">
                <br/>
                <a href="Statistique.html" class="upperButton" >Statistique</a>
            </div>
            <div style="flex:12%" align ="left">
                <br/>
                <a id ="Deconnexion" href="#" class="upperButton" >Déconnexion</a>
            </div>
        </div>   
        <div class="row">
        <br/>
        <div class="columnLeft" align ="center">
            <div style="background-color:#adadad; border: 5px solid #FFFFFF;">
                <br/>
                <h2 style="text-decoration: underline;" id="NomPrenom">Chargement en cours...</h2>
                <br/>
                <div class="row">
                    <div class="column" align = "right">
                        <br/>
                        <div>Civilité :&nbsp; &nbsp;</div>           
                        <br/>
                        <div>Date de Naissance :&nbsp; &nbsp;</div>                  
                        <br/>
                        <div>Zodiaque :&nbsp; &nbsp;</div>                 
                        <br/>
                        <div>Signe Chinois :&nbsp; &nbsp;</div>   
                        <br/>
                        <div>Couleur :&nbsp; &nbsp;</div>   
                        <br/>
                        <div>Animal Totem :&nbsp; &nbsp;</div>   
                        <br/>
                        <div>Adresse :&nbsp; &nbsp;</div>   
                        <br/>
                        <div>Tel :&nbsp; &nbsp;</div>   
                        <br/>
                        <div>Mail :&nbsp; &nbsp;</div>   
                        <br/>
                        
                        
                    </div>
                    <div class="column" align ="left">
                        <br/>
                       <select id="civilite" aria-label="civilite" name="civilite" title="civilite">
                            <option value="M.">M.</option>
                            <option value="Mme">Mme</option>
                        </select>
                        <br/>
                        <br/>
                        <select id="day" aria-label="jour" name="birthday_day" title="jour">
                            <option value="01">1</option>
                            <option value="02">2</option>
                            <option value="03">3</option>
                            <option value="04">4</option>
                            <option value="05">5</option>
                            <option value="06">6</option>
                            <option value="07">7</option>
                            <option value="08">8</option>
                            <option value="09">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>              
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                        </select>
                        <select id="month" aria-label="mois" name="birthday_month" title="mois">
                            <option value="01">1</option>
                            <option value="02">2</option>
                            <option value="03">3</option>
                            <option value="04">4</option>
                            <option value="05">5</option>
                            <option value="06">6</option>
                            <option value="07">7</option>
                            <option value="08">8</option>
                            <option value="09">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <select id="year" aria-label="année" name="birthday_year" title="annee">
                            <option value="2000">2000</option>
                            <option value="1999">1999</option>
                            <option value="1998">1998</option>
                            <option value="1997">1997</option>
                            <option value="1996">1996</option>
                            <option value="1995">1995</option>
                            <option value="1994">1994</option>
                            <option value="1993">1993</option>
                            <option value="1992">1992</option>
                            <option value="1991">1991</option>
                            <option value="1990">1990</option>
                            <option value="1989">1989</option>
                            <option value="1988">1988</option>
                            <option value="1987">1987</option>
                            <option value="1986">1986</option>
                            <option value="1985">1985</option>
                            <option value="1984">1984</option>
                            <option value="1983">1983</option>
                            <option value="1982">1982</option>
                            <option value="1981">1981</option>
                            <option value="1980">1980</option>
                            <option value="1979">1979</option>
                            <option value="1978">1978</option>
                            <option value="1977">1977</option>
                            <option value="1976">1976</option>              
                            <option value="1975">1975</option>
                            <option value="1974">1974</option>
                            <option value="1973">1973</option>
                            <option value="1972">1972</option>
                            <option value="1971">1971</option>
                            <option value="1970">1970</option>
                            <option value="1969">1969</option>
                            <option value="1968">1968</option>
                            <option value="1967">1967</option>
                            <option value="1966">1966</option>
                            <option value="1965">1965</option>
                            <option value="1964">1964</option>
                            <option value="1963">1963</option>
                            <option value="1962">1962</option>
                            <option value="1961">1961</option>
                            <option value="1960">1960</option>
                            <option value="1959">1959</option>
                            <option value="1958">1958</option>
                            <option value="1957">1957</option>
                            <option value="1956">1956</option>
                            <option value="1955">1955</option>
                            <option value="1954">1954</option>
                            <option value="1953">1953</option>
                            <option value="1952">1952</option>
                            <option value="1951">1951</option>
                            <option value="1950">1950</option>
                        </select>
                        <br/>
                        <br/>
                       
                        <span id="zodiaque">Chargement en cours...</span>           
                        <br/>
                        <br/>
                        <span id="signeChinois">Chargement en cours...</span>               
                        <br/>
                        <br/>
                        <span id="couleurFavorite">Chargement en cours...</span>                
                        <br/>
                        <br/>
                        <span id="animalTotem">Chargement en cours...</span>
                        <br/>
                        <br/>
                        <span id="adresse">Chargement en cours...</span>
                        <br/>
                        <br/>
                        <span id="tel">Chargement en cours...</span>
                        <br/>
                        <br/>
                        <span id="mail">Chargement en cours...</span> 
                        <br/>

                    </div>
                    <br/>
                </div>
            </div>
            </div>
            <div class="columnRight" align ="left">
                <div style="background-color:#adadad; border: 5px solid #FFFFFF;">
                <br/>
                <h2 style="text-decoration: underline; text-align: center;" id="nom">Historique de Chargement en cours...</h2>
                <br/>
                <table align="center" class="tab" id="tabHistorique">
                    <colgroup>
                      <col span="6" style="border: 2px solid black">
                    </colgroup>
                    <thead align="left">
                      <tr>
                        <th>&nbsp;Medium &nbsp; &nbsp;</th>
                        <th>&nbsp;Employe &nbsp; &nbsp;</th>
                        <th>&nbsp;Date &nbsp; &nbsp;</th>
                        <th>&nbsp;Heure Début &nbsp; &nbsp;</th>
                        <th>&nbsp;Heure Fin &nbsp; &nbsp;</th>
                        <th>&nbsp;Commentaire &nbsp; &nbsp;</th>
                      </tr>
                    </thead>
                    <tbody id="tab">

                    </tbody>
                </table>
                <br/>
                </div>
                <br/>
                <div style="text-align:right;">
                    <input id="boutonConsultation" class="button" type="submit" value="Réaliser la consultation" />
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>POSIT'IF - 2018 &nbsp; &nbsp; &nbsp;</p>
        </div>
        
        <script>
            $(document).ready(function(){
                
                //checks if there's any employer session active
                $.ajax({
                    url:'./ActionServlet',
                    type: 'POST',
                    data: {
                        action: 'accessEmploye'
                    },
                    dataType: 'json'
                }).done(function(data){
                    var access = data.rights.access;
                    if (!access){
                        window.location="index.html";
                    }
                });
                
                // Nom
                $.ajax({
                    url:'./ActionServlet',
                    type: 'POST',
                    data: {
                        action: 'profilConsultation'
                    },
                    dataType: 'json'
                })
                .done(function(data){
                    if (data.profil.attendu){
                        var civ = data.profil.civ;
                        var nom = data.profil.nom;
                        var prenom = data.profil.prenom;
                        var zodiaque =data.profil.zodiaque;
                        var signeChinois = data.profil.signeChinois;
                        var couleurFavorite =data.profil.couleurFavorite;
                        var animalTotem = data.profil.animalTotem;
                        var adresse =data.profil.adresse;
                        var tel=data.profil.tel;
                        var mail=data.profil.mail;
                        var jour = data.profil.jour;
                        var mois = data.profil.mois;
                        var annee = data.profil.annee;

                        $('#NomPrenom').html(prenom+" "+nom);
                        $('#nom').html(nom);
                        $('#civilite').val(civ);
                        $('#day').val(jour);
                        $('#month').val(mois);
                        $('#year').val(annee);
                        $('#zodiaque').html(zodiaque);
                        $('#signeChinois').html(signeChinois);
                        $('#couleurFavorite').html(couleurFavorite);
                        $('#animalTotem').html(animalTotem);
                        $('#adresse').html(adresse);
                        $('#tel').html(tel);
                        $('#mail').html(mail);
                    }else{
                        window.location = "AttenteClient.html";
                    }
                    
                    //Historique - inside to wait for the other one to finish
                    $.ajax({
                        url:'./ActionServlet',
                        type: 'POST',
                        data: {
                            action: 'historiqueConsultation',
                            mail: mail
                        },
                        dataType: 'json'
                    })      
                    .done(function(data){
                        var historique = data.historique;
                        var contenuHtml = '';
                        var i;
                        for (i=0; i<historique.length; i++){
                            contenuHtml += '<tr style="text-align:left;"> <td>'+historique[i].medium+'&nbsp; &nbsp; </td>';
                            contenuHtml += '<td>&nbsp;'+historique[i].employe+'&nbsp; &nbsp;</td>';
                            contenuHtml += '<td>&nbsp;'+historique[i].date+'&nbsp; &nbsp;</td>';
                            contenuHtml += '<td>&nbsp;'+historique[i].heureDebut+'&nbsp; &nbsp;</td>';
                            contenuHtml += '<td>&nbsp;'+historique[i].heureFin+'&nbsp; &nbsp;</td>';
                            contenuHtml += '<td>&nbsp;'+historique[i].commentaire+'&nbsp; &nbsp;</td><tr>';
                        }
                        $('#tab').html(contenuHtml);
                    })
                    .fail(function(){
                        $('#nom').html('Erreur de chargement');
                    });
                });
                
                $('#boutonConsultation').on("click", function(){
                    $.ajax({
                        url:'./ActionServlet',
                        type: 'POST',
                        data: {
                            action: 'commenceVoyance'
                        },
                        dataType: 'json'
                    })
                    .done(function(data){
                        if (data.voyance.passed){
                            window.location ="Consultation.html";
                        }else{
                            alert("Impossible de realiser consultation");
                        }
                    })
                    .fail(function(){
                        alert("Impossible de realiser consultation");
                    });
                });
                                               
                // deconnection of employer
                $('#Deconnexion').on("click",function(){
                    $.ajax({
                        url:'./ActionServlet',
                        type: 'POST',
                        data: {
                            action: 'deconnectionEmploye'
                        },
                        dataType: 'json'
                    })
                    .done(function(){
                        window.location ="index.html";
                    })
                    .fail(function(){
                        alert("Impossible de se deconnecter");
                    });
                });
               
                
            });
            
        </script>
    </body>
</html>